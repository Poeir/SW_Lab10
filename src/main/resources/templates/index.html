<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Customer Management</title>
</head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Management</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    input, button { padding: 5px; margin: 5px; }
</style>
</head>
<body>

<h1>Customer Management</h1>

<h2>Add / Update Customer</h2>
<form id="customerForm">
    <input type="hidden" id="customerId" />
    <input type="text" id="name" placeholder="Name" required />
    <input type="email" id="email" placeholder="Email" required />
    <button type="submit">Save Customer</button>
</form>

<h2>Customer List</h2>
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="customerTableBody">
        <!-- Customer rows will be inserted here -->
    </tbody>
</table>

<script>
const API_URL = "/api/customers";

async function fetchCustomers() {
    const res = await fetch(API_URL);
    const data = await res.json();
    const tbody = document.getElementById("customerTableBody");
    tbody.innerHTML = "";
    data.forEach(cust => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${cust.id}</td>
            <td>${cust.name}</td>
            <td>${cust.email}</td>
            <td>
                <button onclick="editCustomer(${cust.id})">Edit</button>
                <button onclick="deleteCustomer(${cust.id})">Delete</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

async function editCustomer(id) {
    const res = await fetch(`${API_URL}/${id}`);
    const cust = await res.json();
    document.getElementById("customerId").value = cust.id;
    document.getElementById("name").value = cust.name;
    document.getElementById("email").value = cust.email;
}

async function deleteCustomer(id) {
    if(confirm("Are you sure you want to delete this customer?")) {
        const res = await fetch(`${API_URL}/${id}`, { method: "DELETE" });
        const msg = await res.text();
        alert(msg);
        fetchCustomers();
    }
}

document.getElementById("customerForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const id = document.getElementById("customerId").value;
    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const customerData = { name, email };

    let res;
    if(id) {
        // Update existing customer
        res = await fetch(`${API_URL}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(customerData)
        });
    } else {
        // Create new customer
        res = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(customerData)
        });
    }

    const result = await res.json();
    if(res.ok) {
        alert("Operation successful!");
        document.getElementById("customerForm").reset();
        fetchCustomers();
    } else {
        console.error(result);
        alert("Error: " + JSON.stringify(result));
    }
});

// Initial load
fetchCustomers();
</script>

</body>
</html>
